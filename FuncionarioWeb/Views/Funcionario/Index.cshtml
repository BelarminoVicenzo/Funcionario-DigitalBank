@model IEnumerable<Funcionario.Models.Funcionario>

@{
    ViewBag.Title = "Index";
}

<h2>Funcionários cadastrados</h2>

<p>

    
    <a href="" class="btn  pull-right"><input type="submit" value="Actualizar dados" id="btnActualizar" class="btn btn-default" /></a>
    <a href="/Funcionario/Create" class="btn  pull-right"><input type="submit" value="Novo Funcionário" class="btn btn-default" /></a>

</p>
 
<div id="funcionarioResults">
    
</div>
<script type="text/javascript">


    window.onload = function () {
        ActualizarDados();
    }

    function Delete(id) {


        //var DeleteUrl = $("#btnDelete").attr('href');
        var deleteUrl = id.getAttribute("href");
        var funcionarioName = deleteUrl.split(",").pop();

        if (confirm('Pretende eliminar este registo?('+funcionarioName+')')) {
            $.ajax({
                url: deleteUrl,
                dataType: "json",
                type: "POST",
                contentType: "application/json",
                error: function (error) {
                    alert('Erro ao eliminar. ' + error.responseText);
                },
                success: function (response) {

                    window.location.reload();

                }
            });
        }

    }

    document.getElementById('btnActualizar').addEventListener('click', ActualizarDados);

    function ActualizarDados() {
        let xhr = new XMLHttpRequest();
        let output = '';
         

        xhr.open('GET', '/Funcionario/GetAllTest', true);
        xhr.onload = function () {
            var result = JSON.parse(this.responseText);
         
            for (var i = 0; i < result.length; i++) {

                output += '<table class="table">' +
                    '<tr><th> C&#243;digo</th><th>Nome</th>' +
                    '<th></th></tr >' +
                    '<tr><td>' + result[i].Id + '</td >' +
                    '<td>' + result[i].Nome + '</td>' +
                    '<td><a href="/Funcionario/Edit/'+result[i].Id+'">Alterar</a> |' +
                    '<a href="/Funcionario/Delete/' + result[i].Id +','+ result[i].Nome +'" id="btnDelete" name="btnDelete" onclick="Delete(this)">Excluir</a></td ></tr ></table > ';
            }
          

            document.getElementById('funcionarioResults').innerHTML = output;
      

        }
        xhr.send();

       

    }


</script>